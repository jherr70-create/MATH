<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Math Addition Game</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      font-family: sans-serif;
      background-color: #fef6e4;
      color: #001858;
    }
    body {
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #game-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }
    #setup {
      font-size: 2rem;
      margin-bottom: 2rem;
    }
    input[type="number"] {
      font-size: 2rem;
      width: 6rem;
      margin: 0.5rem;
      text-align: center;
    }
    button {
      font-size: 2rem;
      padding: 0.5rem 1rem;
      margin-top: 1rem;
      background-color: #f582ae;
      color: white;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
    }
    button:hover {
      background-color: #ffb3c6;
    }
    #score {
      font-size: 4rem;
      margin: 2rem 0;
    }
    #question-container {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      gap: 2rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }
    .number-block {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .digit {
      font-size: 10rem;
    }
    .symbol {
      font-size: 10rem;
      font-weight: bold;
      display: flex;
      align-items: center;
      height: 10rem;
    }
    .number-block input {
      font-size: 8rem;
      letter-spacing: 1rem;
      border: none;
      border-bottom: 6px solid #001858;
      text-align: center;
      width: 10rem;
      outline: none;
      background-color: #fef6e4;
      color: #001858;
    }
    #feedback {
      margin-top: 2rem;
      font-size: 4rem;
      height: 4rem;
    }
    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.3); opacity: 0.7; }
      100% { transform: scale(1); opacity: 1; }
    }
    .pulse {
      animation: pulse 0.5s ease;
    }
    @keyframes bounce {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }
    .correct-feedback {
      animation: bounce 0.5s ease;
    }
  </style>
</head>
<body>
  <div id="game-container">
    <div id="setup">
      <div>
        <label>Left number range:</label><br />
        Min <input type="number" id="min1" value="1" /> Max <input type="number" id="max1" value="10" />
      </div>
      <div>
        <label>Right number range:</label><br />
        Min <input type="number" id="min2" value="1" /> Max <input type="number" id="max2" value="10" />
      </div>
      <button onclick="startGame()">Start Game</button>
    </div>

    <div id="score" style="display:none;">Score: 0</div>

    <div id="question-container" style="display:none;">
      <div class="number-block" id="left-block">
        <div class="digit" id="digit-left">?</div>
      </div>
      <div class="symbol">+</div>
      <div class="number-block" id="right-block">
        <div class="digit" id="digit-right">?</div>
      </div>
      <div class="symbol">=</div>
      <div class="number-block">
        <input id="input" type="text" maxlength="2" autofocus style="display:none;" />
      </div>
    </div>

    <div id="feedback"></div>
    <script>
      const BASE_URL = "https://raw.githubusercontent.com/jherr70-create/MATH/";
      function getAudioUrl(name) {
        return `${BASE_URL}${name}.mp3`;
      }

      let num1, num2;
      let score = 0;
      const questionStats = {};
      let min1 = 1, max1 = 10, min2 = 1, max2 = 10;

      function playAudioSequence(sequence, elements = []) {
        const audioFiles = sequence.map(n => {
          if (typeof n === 'number') {
            const names = ['ONE','TWO','THREE','FOUR','FIVE','SIX','SEVEN','EIGHT','NINE','TEN',
              'ELEVEN','TWELVE','THIRTEEN','FOURTEEN','FIFTEEN','SIXTEEN','SEVENTEEN','EIGHTEEN','NINETEEN','TWENTY'];
            return names[n - 1];
          } else {
            return n.toUpperCase();
          }
        });

        let index = 0;
        function playNext() {
          if (index >= audioFiles.length) return;
          const audio = new Audio(getAudioUrl(audioFiles[index]));
          const el = elements[index];
          if (el) {
            el.classList.add('pulse');
            setTimeout(() => el.classList.remove('pulse'), 500);
          }
          audio.onended = () => {
            index++;
            playNext();
          };
          audio.onerror = () => {
            console.warn(`Missing audio: ${audioFiles[index]}`);
            index++;
            playNext();
          };
          audio.play();
        }
        playNext();
      }

      function playCorrectSound() {
        const audio = new Audio(getAudioUrl("CORRECT"));
        audio.play().catch(() => {});
      }

      function playIncorrectSound() {
        const audio = new Audio(getAudioUrl("INCORRECT"));
        audio.play().catch(() => {});
      }

      function generateQuestion() {
        const allQuestions = [];
        for (let i = min1; i <= max1; i++) {
          for (let j = min2; j <= max2; j++) {
            const key = `${i}+${j}`;
            const count = questionStats[key] || 0;
            allQuestions.push({ num1: i, num2: j, count });
          }
        }
        allQuestions.sort((a, b) => a.count - b.count);
        const candidates = allQuestions.slice(0, 5);
        const chosen = candidates[Math.floor(Math.random() * candidates.length)];
        num1 = chosen.num1;
        num2 = chosen.num2;

        document.getElementById('digit-left').textContent = num1;
        document.getElementById('digit-right').textContent = num2;
        document.getElementById('input').value = '';
        document.getElementById('feedback').textContent = '';

        playAudioSequence(
          [num1, 'plus', num2, 'equals'],
          [
            document.getElementById('digit-left'),
            document.querySelectorAll('.symbol')[0],
            document.getElementById('digit-right'),
            document.querySelectorAll('.symbol')[1]
          ]
        );
      }

      function startGame() {
        min1 = parseInt(document.getElementById('min1').value);
        max1 = parseInt(document.getElementById('max1').value);
        min2 = parseInt(document.getElementById('min2').value);
        max2 = parseInt(document.getElementById('max2').value);

        document.getElementById('setup').style.display = 'none';
        document.getElementById('score').style.display = 'block';
        document.getElementById('question-container').style.display = 'flex';
        document.getElementById('input').style.display = 'block';

        const container = document.getElementById('game-container');
        container.style.border = '1rem solid #001858';
        container.style.borderRadius = '2rem';
        container.style.padding = '2rem';

        generateQuestion();
      }
      document.getElementById('input').addEventListener('input', function () {
        const answer = parseInt(this.value, 10);
        const correct = num1 + num2;

        if (!isNaN(answer)) {
          if (answer === correct) {
            const key = `${num1}+${num2}`;
            questionStats[key] = (questionStats[key] || 0) + 1;

            score++;
            document.getElementById('score').textContent = `Score: ${score}`;
            const feedback = document.getElementById('feedback');
            feedback.textContent = '✅ Correct!';
            feedback.classList.add('correct-feedback');
            playCorrectSound();

            setTimeout(() => {
              feedback.classList.remove('correct-feedback');
              generateQuestion();
            }, 1000);
          } else if (answer > correct || this.value.length >= 2) {
            const feedback = document.getElementById('feedback');
            feedback.textContent = '❌ Try again!';
            playIncorrectSound();

            setTimeout(() => {
              this.value = '';
              feedback.textContent = '';
            }, 1000);
          }
        }
      });
    </script>
  </div>
</body>
</html>
